<html>

<head>
<title>Le réseau des Archives de France</title>

 <meta charset="utf-8">
 <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width">
<meta name="language" content="fr">

   <!-- LIBRAIRIES LEAFLET FOND DE CARTE -->

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="">
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

<!-- LIBRAIRIES LEAFLET MARKERS CLUSTERS -->
<script type="text/javascript" src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">


<!-- LIBRAIRIES LEAFLET SIDEBAR -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./css/leaflet-sidebar.css" />


<!-- LIBRAIRIE JQUERY -->
 <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  


<style>
 

html,
      body {
        width: 100%;
        height: 100%;
      }


 #map {
  width: 100%;
  height: 100%;
  position: relative;
} 


      
    
</style>
  </head>

   





<body>

<!-- CORPS DE LA PAGE -->

<div>

<!-- INITIALISATION DE LA DIV SIDEBAR (PANNEAU LATÉRAL) -->
<!-- Documentation : https://github.com/noerw/leaflet-sidebar-v2 -->

<div id="sidebar" class="leaflet-sidebar collapsed">

        <!-- Barre de navigation -->
        <div class="leaflet-sidebar-tabs">
            <!-- Icônes en haut de la barre de navigation -->
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars active"></i></a></li>
                <li><a href="#autopan" role="tab"><i class="fa fa-arrows"></i></a></li>
            </ul>
        </div>

        <!-- Contenu du panneau une fois qu'il est ouvert-->
        <div class="leaflet-sidebar-content">
            <div class="leaflet-sidebar-pane" id="home">
                <h1 class="leaflet-sidebar-header"><i>Informations pratiques</i>
                    <span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>

                <h3 class="nom"></h3>
              
              <ul>
                <!-- Création des items qui recueilleront les données issues du fichier GeoJSON de l'annuaire, afin de permettre un affichage dynamique selon le marqueur/service
                  qui a été sélectionné -->
               <li><i class="fa fa-clock"></i><b>Horaires d'ouverture :</b>  <p class="horaires"></p></li>
               <li><i class='fa fa-building'></i><b>Adresse : </b> <p class="adresse"></p></li>
               <li><i class="fa fa-phone-alt"></i><b>Téléphone :</b><p class="telephone"></p></li>
               <li><i class="fa fa-envelope"></i><b>Contact :</b> <p class="courriel"></p> </li>
               <li><b>Site internet :</b> <p class="site_internet"></p> </li>
               <li><b>Lien vers <i>FranceArchives</i></b>: <p class="lien_fa"></p></li>
              </ul>
               
            </div>

            <div class="leaflet-sidebar-pane" id="messages">
                <h1 class="leaflet-sidebar-header">Messages<span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
    </div>



<!-- INITIALISATION DE LA DIV CONTENANT LA CARTE -->
<div>
  <div id="map" class="leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom" tabindex="0" style="float: left; outline: none; display:inline-block; "></div>
</div>

</div>







<!-- Second script nécessaire pour la sidebar -->
<script src="./js/leaflet-sidebar_2.js"></script>


<script>

// NOTE : Les fonctionnalités qui ont été définies plusieurs fois ne seront pas à chaque fois commentées afin de ne pas surcharger le script et gagner en lisibilité


// VARIABLES POUR L'IMPORT DES DIFFÉRENTS FICHIERS À REQUÊTER 
// Fichier GeoJSON comprenant les pays du monde entier, reformaté, téléchargé via l'application https://geojson-maps.ash.ms/ 
// La France a été enlevée
var url_world_without_france = 'http://0.0.0.0:8000/geojson_layers/world_medium_without_france2.json';


// Fichier GeoJSON de la France métropolitaine téléchargé sur https://github.com/gregoiredavid/france-geojson
var url_french_mainland = 'http://0.0.0.0:8000/geojson_layers/metropole.geojson';


// Fichier GeoJSON des départements français métropolitains téléchargé sur https://github.com/gregoiredavid/france-geojson
var url_departements_metropole = 'http://0.0.0.0:8000/geojson_layers/departements.geojson'

// Fichier JSON téléchargé à partir de https://github.com/gregoiredavid/france-geojson/blob/master/departements-avec-outre-mer.geojson
// À partir de ce fichier, les départements d'outre-mer ont été extraits et transférés dans un fichier à part, puis le fichier a été validé grâce à JSON Formatter 
var url_departements_outre_mer =  'http://0.0.0.0:8000/geojson_layers/departements_outre_mer_uniquement.json'

// Fichier GeoJSON comprenant les données issues de l'annuaire de FranceArchives. Les données ont été formatées en GeoJSON grâce
// à un script python à partir du fichier CSV original
var url_data_annuaire = 'http://0.0.0.0:8000/data_annuaire.geojson';


// VARIABLES MARQUEURS HTML - Élaboration de marqueurs vectoriels
// Documentation : https://stackoverflow.com/questions/23567203/leaflet-changing-marker-color

// Les couleurs ont été choisies selon la charte graphique du ministère de la Culture et de la Communication

const gold = '#DD9F25'
const blue= '#134094'

// Le marqueurs de couleur ocre indiquent l'emplacement de tous les services, exceptées les Archives départementales


// On définit les caractéristiques "physiques" du marqueur
const goldenMarkers = `
  background-color: ${gold};
  width: 1.5rem;
  height: 1.5rem;
  display: block;
  left: -0.5rem;
  top: -0.5rem;
  position: relative;
  border-radius: 1.5rem 1.5rem 0;
  transform: rotate(45deg);
  border: 1px solid #FFFFFF`



// On crée l'icône grâce à la méthode Leaflet 'L.divIcon'
const goldenIcon = L.divIcon({
  className: "my-custom-pin",
  iconAnchor: [0, 24],
  labelAnchor: [-6, 0],
  popupAnchor: [0, -36],
  html: `<span style="${goldenMarkers}" />`
})


// Les marqueurs bleus indiquent l'emplacement des services d'archives départementales


const blueMarkers = `
  background-color: ${blue};
  width: 1.5rem;
  height: 1.5rem;
  display: block;
  left: -0.5rem;
  top: -0.5rem;
  position: relative;
  border-radius: 1.5rem 1.5rem 0;
  transform: rotate(45deg);
  border: 1px solid #FFFFFF`

const blueIcon = L.divIcon({
  className: "my-custom-pin",
  iconAnchor: [0, 24],
  labelAnchor: [-6, 0],
  popupAnchor: [0, -36],
  html: `<span style="${blueMarkers}" />`
})


// Fonctions surbrillance des pays au passage du curseur
// Documentation : http://embed.plnkr.co/fdTnA9CyJdJejiPq2q8M/

// Initialise la surbrillance au passage du curseur


		function highlight (layer) {
			layer.setStyle({
				stroke: false,
				fillColor: '#00B48C'
			});
			if (!L.Browser.ie && !L.Browser.opera) {
				layer.bringToFront();
			}
		}


// Enlève la surbrillance une fois le curseur enlevé
		function dehighlight (layer) {
		  if (selected === null || selected._leaflet_id !== layer._leaflet_id) {
			  world_layer.resetStyle(layer);
		  }
		}


// Zoom sur l'entité géographique sélectionnée et maintien de la surbrillance
		function select (layer) {
		  if (selected !== null) {
		    var previous = selected;
		  }
			map.fitBounds(layer.getBounds());
			selected = layer;
			if (previous) {
			  dehighlight(previous);
			}
		}

		var selected = null;




       //  INITIALISATION DE LA CARTE
       // Documentation généraliste : https://leafletjs.com/reference-1.7.1.html
    // Le développement de la carte a été effectué à partir de ces exemples : 
    // http://www.gistechsolutions.com/leaflet/DEMO/sports/index2.html
    // https://www.youtube.com/watch?v=Pxa7PPqp6Fc

// On initialise la carte et la vue au chargement de la page

	var map = L.map('map',{
		minZoom: 1.5
	}
		).setView([45.070312, 	7.6868565], 2.4); 

   // On récupère un fond de carte choisi sur https://leaflet-extras.github.io/leaflet-providers/preview/

	var osm = new L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',{ 
				attribution: '© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);

		
// MONDE - PREMIERE COUCHE VECTORIELLE ("layer")
// Fichier GeoJSON téléchargé à partir de l'application : https://geojson-maps.ash.ms/
// Le fichier a ensuite été reformaté et nous en avons enlevé la France (métropolitaine et d'outre-mer, exceptés certains territoires comme la Nouvelle-Calédonie, 
// Wallis-et-Futuna, Saint-Martin, Saint-Pierre-et-Miquelon)


  // On crée la variable pour la couche vectorielle "monde". La méthode L.geoJson accepte les données formatées en JSON ou GeoJSON
  // et permet la création d'une couche vectorielle, pour afficher ensuite les données sur la carte 
  
     var world_layer = L.geoJson(null, {

				style: function (feature) {
          // Paramétrages pour empêcher l'affichage des contours vectorisés des pays en bleu et le remplissage des "polygons" en bleus.
          // Ainsi les pays sont affichés de la même couleur que le fond de carte initial
		  			return {
              // Code couleur HTML transparent
		  				color: '#ffffff',
		  				opacity: 0.4,
              // Empêche les contours bleus des frontières
		  				stroke: false
		  			};
		  		},
          // Pour chaque élément (pays) :
          // on appelle la fonction de surbrillance lorsqu'on passe la curseur au-dessus d'un pays
					onEachFeature: function (feature, layer) {
				    layer.on({
		  		    'mouseover': function (e) {
		  		      highlight(e.target);
                this.openPopup();
		  		    },
              // on appelle la fonction d'enlèvement de surbrillance lorsque le curseur n'est plus sur ce pays
		  		    'mouseout': function (e) {
		  		      dehighlight(e.target);
                this.closePopup();
		  		    },
              // Au clic sur un pays on appelle la fonction qui permet le zoom
		  				'click': function (e) {
		  				  select(e.target);
		  				}
		  			});

            var popupContent = feature.properties.name ;
            layer.bindPopup(popupContent);
				}
				
				});
   
	// Grâce à une requête GET on récupère les données présentes dans le fichier localisé à l'adresse indiquée dans la variable "url_world_without_france" précitée
  // Documentation : http://www.gistechsolutions.com/leaflet/DEMO/sports/index2.html
	$.getJSON(url_world_without_france, function(data) {
  // On ajoute ces données dans la "couche monde" puis on ajoute cette couche (ce "layer") à la carte			
		world_layer.addData(data).addTo(map);
	});	


// FIN COUCHE VECTORIELLE MONDE

// COUCHE VECTORIELLE FRANCE METROPOLITAINE 


// On repète les mêmes fonctions que pour la couche vectorielle 'monde'
var french_mainland = L.geoJson(null, {

        style: function (feature) {
            return {
              color: '#ffffff',
              opacity: 0.4,
              stroke: false
            };
          },
          onEachFeature: function (feature, layer) {
            layer.on({
              'mouseover': function (e) {
                highlight(e.target);
              },
              'mouseout': function (e) {
                dehighlight(e.target);
              },
              'click': function (e) {
                select(e.target);
                // Une fois que l'utilisateur a cliqué sur la France, la couleur verte qui apparaissait en surbrillance ne se maintient pas, contrairement aux autre pays
                // Cela permet à l'utilisateur de percevoir les surbrillances au survol des départements métropolitains et permet de rendre plus agréable la navigation
                french_mainland.resetStyle(layer);


                // Imbrication de la couche vectorielle des départements métropolitains
                // Quand l'utilisateur clique sur la France métropolitaine, le zoom s'effectue et il peut alors sélectionner un département
  
                      var departements_metropole = L.geoJson(null, {
                      style: function (feature) {
                                return {
                                  color: '#ffffff',
                                  opacity: 0.4,
                                  stroke: false
                                };
                              },
                              onEachFeature: function (feature, layer) {
                                layer.on({
                                  'mouseover': function (e) {
                                    highlight(e.target);
                                    // Au passage du curseur, une infobulle indiquant le nom du département s'ouvre puis se ferme
                                    this.openPopup();
                                  },
                                  'mouseout': function (e) {
                                    dehighlight(e.target);
                                    this.closePopup();
                                  },
                                  'click': function (e) {
                                    select(e.target);
                                    // Une fois que l'utilisateur a cliqué sur un département, la couleur verte ne se maintient pas, car elle peut être parasite
                                    departements_metropole.resetStyle(layer);
                                   

                                  }
                                });
                              
                              var popupContent = feature.properties.nom ;
                                layer.bindPopup(popupContent);

                            }
                            
                            });
                       

                      $.getJSON(url_departements_metropole, function(data) {      
                        departements_metropole.addData(data).addTo(map);
                      }); 
                                  }
                                });
                            }
                            
                            });
   
  
  $.getJSON(url_french_mainland, function(data) {     
    french_mainland.addData(data).addTo(map);
  });

// FIN COUCHE VECTORIELLE MÉTROPOLE ET DÉPARTEMENTS MÉTROPOLITAINS



// DÉBUT COUCHE VECTORIELLE DES DÉPARTEMENTS ULTRA-MARINS

// Fichier GeoJSON original téléchargé à partir de cette adresse : https://github.com/gregoiredavid/france-geojson/blob/master/departements-avec-outre-mer.geojson
// On en a extrait les départements ultra-marins pour former un autre fichier GeoJSON qui ne contient que ces départements
var departements_outre_mer_layer = L.geoJson(null, {
  style: function (feature) {
            return {
              color: '#ffffff',
              opacity: 0.4,
              stroke: false
            };
          },
          onEachFeature: function (feature, layer) {
            layer.on({
              'mouseover': function (e) {
                highlight(e.target);
                this.openPopup();
              },
              'mouseout': function (e) {
                dehighlight(e.target);
                this.closePopup();
              },
              'click': function (e) {
                select(e.target);
                // Une fois que l'utilisateur a cliqué sur un département, la couleur verte ne se maintient pas, car elle peut être parasite
                  departements_outre_mer_layer.resetStyle(layer);

             }
            });
          
          var popupContent = feature.properties.nom ;
              
            layer.bindPopup(popupContent);

        }
        
        });
   
  
  $.getJSON(url_departements_outre_mer, function(data) {      
    departements_outre_mer_layer.addData(data).addTo(map);
  }); 

  // FIN COUCHE VECTORIELLE DES DÉPARTEMENTS ULTRA-MARINS



  //DEBUT DE LA COUCHE VECTORIELLE DES MARQUEURS


// On crée un cluster qui comprend tous les services d'archives partenaires de FranceArchives, indépendamment de leur catégorie
// Documentation pour la création des clusters : https://www.datavis.fr/index.php?page=leaflet-cluster

var clusterServices = new L.MarkerClusterGroup({
// De même que pour la sélection d'un pays ou d'un département, on empêche la formation d'un polygon bleu au survol d'un cluster
// Documentation : https://stackoverflow.com/questions/35392265/leaflet-markercluster-change-color-of-coverage-on-hover
    polygonOptions: {
      color: '#ffffff',
              opacity: 0.4,
              stroke: false
        }
      });
       
       var services = L.geoJson(null, {
			
      // Grâce à la fonction "pointToLayer" on récupère les coordonnées géographiques présentes à l'emplacement dédié dans le fichier GeoJSON
            pointToLayer: function(feature, latlng) {

				// Si le service en question appartient à la catérgorie "D" (pour 'Archives départementales')
				if (feature.properties.Categorie_de_service == "D"){
          // Alors un marqueur bleu (défini auparavant dans la variable) se positionne à cet emplacement sur la carte
				return L.marker(
          latlng, 
          {icon:blueIcon}, 
          {opacity: 1}
			)
			}

				else
          // Sinon c'est un marqueur ocre
            	return marker = L.marker(
                latlng, 
                {icon:goldenIcon}, 
                {opacity: 1})
              //.bindTooltip(feature.properties.Name);

    },


              //.bindTooltip(feature.properties.Name);

              // Pour chaque élément (service) de la couche "services"

			onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
      // On définit le contenu de l'infobulle
				var popupContent = "<p><b>" +
				feature.properties.Nom_du_service + "</b></p>" ;
					
        // On lie le contenu de l'infobulle à la couche vectorielle et on fait ouvrir puis fermer l'infobulle au passage du curseur
					layer.bindPopup(popupContent);
					layer.on('mouseover', function (e) {
		            this.openPopup();
		        });
		        layer.on('mouseout', function (e) {
		            this.closePopup();
                //sidebar.close();
		        });

            // Au double clic sur un marqueur
            layer.on('dblclick', function(e) {
              // On centre la vue de la carte sur le marqueur au zoom de niveau 19
              //Documentation : https://stackoverflow.com/questions/29385063/how-to-zoom-on-marker-click-event-in-mapbox-leaflet
              map.setView(e.latlng, 19);
              // On paramètre l'ouverture du panneau latéral à la page principale
              sidebar.open('home');
              // On appelle les class de la page HTML du panneau latéral pour y insérer le contenu récupéré dans le GeoJSON 
              // Documentation : https://stackoverflow.com/questions/50571549/change-info-on-sidebar-according-with-marker-clicked-using-leaflet
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              // Documentation : https://alexandre.alapetite.fr/doc-alex/alx_mailto.html
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville);       
              if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else{

                        $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );}
              

            });
            // Quand on clique de nouveau une fois sur le marqueur, le panneau latéral se ferme
            layer.on('click', function(e) {
              sidebar.close();
			
		});
}
});

		// De même, grâce à la requête GET on récupère les données du fichier GeoJSON généré à partir du fichier CSV de l'annuaire
	$.getJSON(url_data_annuaire, function(data2) {
  // On enlève la fonction 'addTo(map)' pour empêcher l'affichage des icônes directement sur la carte
  // Documentation : https://www.datavis.fr/index.php?page=leaflet-cluster			
		services.addData(data2);//.addTo(map);
    // Une fois qu'on a ajouté ces données à la "couche" "services" on ajoute cette couche au cluster "clusterServices"
    clusterServices.addLayer(services);
    // on ajoute ensuite le cluster des services à la carte
    map.addLayer(clusterServices);
	});	

	
//// FIN DE LA COUCHE GLOBALE TOUS LES SERVICES ////

///// VARIABLES - DIFFERENTES CATEGORIES DE SERVICES ///

// NOTES : Les opérations qui ont été effectuées pour la couche globale des services ont été répétées, mais cette fois-ci en filtrant chacune des catégories
// afin de créer des clusters propres à chaque catégorie de services et permettre l'affichage de ces clusters au filtrage 

 var clusterCommunes = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var communes = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "C"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
	},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
					
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              // Documentation : https://stackoverflow.com/questions/29385063/how-to-zoom-on-marker-click-event-in-mapbox-leaflet
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
              
            });
			layer.on('click', function(e) {
              sidebar.close();
      
    });
}

});
$.getJSON(url_data_annuaire, function(data2) {			
		communes.addData(data2);//.addTo(map);
    clusterCommunes.addLayer(communes);
    // Ici on enlève l'affichage par défaut au chargement de la pages du cluster 'communes', et de tous les autres, pour que seul le cluster 
    // 'Tous les services' apparaisse au chargement de la page
    //map.addLayer(clusterCommunes);
	});	


var clusterArchivesDepartementales = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var archives_departementales = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "D"){
				return L.marker(
          latlng, 
          {icon:blueIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
						
				
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		archives_departementales.addData(data2);//.addTo(map);
    clusterArchivesDepartementales.addLayer(archives_departementales);
    //map.addLayer(clusterArchivesDepartementales);
	});	

var clusterEntreprises = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var entreprises = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "E"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
					
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
          layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});
$.getJSON(url_data_annuaire, function(data2) {			
		entreprises.addData(data2);//.addTo(map);
    clusterEntreprises.addLayer(entreprises);
    //map.addLayer(clusterEntreprises);
	});


var clusterHopitaux = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });


var hopitaux = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "H"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
					
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			

		    layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		hopitaux.addData(data2);//.addTo(map);
    clusterHopitaux.addLayer(hopitaux);
    //map.addLayer(clusterHopitaux);
	});	

var clusterInstitutions = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var institutions = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "I"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
					
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else
                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
        layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		institutions.addData(data2);//.addTo(map);
    clusterInstitutions.addLayer(institutions);
    //map.addLayer(clusterInstitutions);
	});	


var clusterMinisteres = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var ministeres = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "M"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
				
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		ministeres.addData(data2);//.addTo(map);
    clusterMinisteres.addLayer(ministeres);
    //map.addLayer(clusterMinisteres);
	});	


var clusterServicesCompetencesNationales = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var services_competences_nationales = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "N"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
						
				
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
             if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			

		layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		services_competences_nationales.addData(data2);//.addTo(map);
    clusterServicesCompetencesNationales.addLayer(services_competences_nationales);
    //map.addLayer(clusterServicesCompetencesNationales);
	});	




var clusterOrganismes = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });


var organismes = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "O"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
						
				
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		organismes.addData(data2);//.addTo(map);
    clusterOrganismes.addLayer(organismes);
    //map.addLayer(clusterOrganismes);
	});	


var clusterAssemblees = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var assemblees = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "P"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
					
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		assemblees.addData(data2);//.addTo(map);
    clusterAssemblees.addLayer(assemblees);
    //map.addLayer(clusterAssemblees);
	});	


var clusterConseilsRegionaux = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var conseils_regionaux = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "R"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
						
				
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		conseils_regionaux.addData(data2);//.addTo(map);
    clusterConseilsRegionaux.addLayer(conseils_regionaux);
    //map.addLayer(clusterConseilsRegionaux);
	});	


var clusterUniversites = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });

var universites = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "U"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
					
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		universites.addData(data2);//.addTo(map);
    clusterUniversites.addLayer(universites);
    //map.addLayer(clusterUniversites);
	});	



var clusterDrac = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });


var drac = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "Y"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
			
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville); 
               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            });
			
layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		drac.addData(data2);//.addTo(map);
    clusterDrac.addLayer(drac);
    //map.addLayer(clusterDrac);
	});	



var clusterServiceInterministeriel = new L.MarkerClusterGroup({

    polygonOptions: {
      color: '#ffffff',
              opacity : 0.4,
              stroke: false
        }
      });


var service_interministeriel = new L.geoJson(null, {
		
          pointToLayer: function(feature, latlng) {
		
				if (feature.properties.Categorie_de_service == "Z"){
				return L.marker(
          latlng, 
          {icon:goldenIcon}, 
          {opacity: 1})
		}
		},
			

    onEachFeature: function (feature, layer) {
				layer._leaflet_id = feature.properties.Adresse_du_service;

			
				var popupContent = "<p><b>" +
        feature.properties.Nom_du_service + "</b></p>" ;
				
					layer.bindPopup(popupContent);
          layer.on('mouseover', function (e) {
                this.openPopup();
            });
            layer.on('mouseout', function (e) {
                this.closePopup();
            });
             layer.on('dblclick', function(e) {
              map.setView(e.latlng, 19);
              sidebar.open('home');
              $(".nom").html(feature.properties.Nom_du_service);
              $(".telephone").html(feature.properties.Telephone);
              $(".horaires").html(feature.properties.Horaires_d_ouverture);
              if(feature.properties.Courriel == "Non communiqué") {
                      $(".courriel").html(feature.properties.Courriel) }
                      else {$(".courriel").html('<a href="mailto:'+ feature.properties.Courriel +'"  target="_blank">' + feature.properties.Courriel + '</a>');}
              $(".lien_fa").html('<a href="'+ feature.properties.Lien_FranceArchives  +'" target="_blank" >' + feature.properties.Lien_FranceArchives + '</a>' );
              $(".adresse").html(feature.properties.Adresse_du_service + ", " + feature.properties.Code_postal + ", " + feature.properties.Ville);

               if(feature.properties.Site_internet == "Non communiqué") {
                       $(".site_internet").html(feature.properties.Site_internet) }
                      
                      else

                         $(".site_internet").html('<a href="'+ feature.properties.Site_internet + '"target="_blank">' + feature.properties.Site_internet + "</a>" );
            
            });

      
			
layer.on('click', function(e) {
              sidebar.close();
      
    });
}
});

$.getJSON(url_data_annuaire, function(data2) {			
		service_interministeriel.addData(data2);//.addTo(map);
    clusterServiceInterministeriel.addLayer(service_interministeriel);
    //map.addLayer(clusterServiceInterministeriel);
	});	
/// FIN VARIABLES - DIFFERENTES CATEGORIES ///



/////////////////////Layer Control  /////////////////////////////////////////////////
// On initialise le panneau qui va permettre le filtrage par catégorie de service et donc qui va contrôler les différentes couches vectorielles


var overlays = {
  'Tous les services': clusterServices,
  'Archives départementales': clusterArchivesDepartementales,
      'Communes': clusterCommunes,
      'Entreprises': clusterEntreprises,
      'Hôpitaux': clusterHopitaux,
      'Institutions': clusterInstitutions,
      'Ministères': clusterMinisteres,
      'Services à compétences nationales': clusterServicesCompetencesNationales,
      'Organismes': clusterOrganismes,
      'Assemblées parlementaires': clusterAssemblees,
      'Conseils régionaux' : clusterConseilsRegionaux,
      'Universités': clusterUniversites,
      'DRACs': clusterDrac,
      'Service interministériel': clusterServiceInterministeriel
      
};



// Documentation : http://jsfiddle.net/nathansnider/s408tnwv/
// Documentation : https://gis.stackexchange.com/questions/180644/how-to-use-leaflets-overlayadd-event
// Si la case 'Tous les services' est cochée, alors toutes les autres cases aussi
map.on('overlayadd', function(eo) {
 if (eo.name === 'Tous les services') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
      $(":checkbox")[1].checked = true;
      $(":checkbox")[2].checked = true;
      $(":checkbox")[3].checked = true;
      $(":checkbox")[4].checked = true;
      $(":checkbox")[5].checked = true;
      $(":checkbox")[6].checked = true;
      $(":checkbox")[7].checked = true;
      $(":checkbox")[8].checked = true;
      $(":checkbox")[9].checked = true;
      $(":checkbox")[10].checked = true;
      $(":checkbox")[11].checked = true;
      $(":checkbox")[12].checked = true;
      $(":checkbox")[13].checked = true;
    });
  }

});

// Piste de réflexion pour le décochage de la case 'Tous les services' lors du décochage d'une des cases - partiellement fonctionnel
// Au décochage d'une des cases, la case 'Tous les services' devait être décochée
map.on('overlayremove', function(eo) {
 if (eo.name === 'Communes') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});

map.on('overlayremove', function(eo) {
 if (eo.name === 'Archives départementales') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});

map.on('overlayremove', function(eo) {
 if (eo.name === 'Entreprises') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Institutions') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Ministeres') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Services à compétences nationales') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Services à compétences nationales') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Organismes') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Assemblées parlementaires') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Conseils régionaux') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Universités') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'DRACs') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
map.on('overlayremove', function(eo) {
 if (eo.name === 'Service interministériel') {
    setTimeout(function(e) {
      // Documentation : https://stackoverflow.com/questions/20731973/how-to-check-the-checkbox-without-id-class-using-javascript
     $(":checkbox")[0].checked = false;
   });
  }
});
 


// Si on enlève la couche 'Tous les services' alors toutes les autres couches sont enlevées
map.on('overlayremove', function(eo){
  if (eo.name === 'Tous les services') {
    setTimeout(function(){
      map.removeLayer(clusterArchivesDepartementales);
      map.removeLayer(clusterCommunes);
      map.removeLayer(clusterEntreprises);
      map.removeLayer(clusterHopitaux);
      map.removeLayer(clusterInstitutions);
      map.removeLayer(clusterMinisteres);
      map.removeLayer(clusterServicesCompetencesNationales);
      map.removeLayer(clusterOrganismes);
      map.removeLayer(clusterAssemblees);
      map.removeLayer(clusterConseilsRegionaux);
      map.removeLayer(clusterUniversites);
      map.removeLayer(clusterDrac);
      map.removeLayer(clusterServiceInterministeriel)});
    }
  });

// Piste de réflexion, partiellement fonctionnelle - Si on enlève la couche 'Communes' alors la couche 'Tous les services' est enlevée
map.on('overlayremove', function(eo){
  if (eo.name === 'Communes') {
   setTimeout(function(){
      map.removeLayer('Tous les services') })
   }
  });


lcontrol = L.control.layers( null,
      overlays, {
        collapsed:false, 
        position: 'topleft'}

        ).addTo(map);




        // Side bar
  // Documentation : https://github.com/noerw/leaflet-sidebar-v2

var sidebar = L.control.sidebar({ 
  container: 'sidebar', 
  position: 'right',
  closeButton : true })
            .addTo(map)
            //.open('home');

        // Ajoute un panneau dynamique au panneau latéral
        sidebar
            .addPanel({
                id:   'mail',
                tab:  '<i class="fa fa-envelope"></i>',
                title: 'Messages',
                button: function() { alert('opened via JS callback') },
                disabled: true,
            })

      






 </script>


</body></html>